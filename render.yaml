services:
  # 1. Banco de Dados PostgreSQL Gerenciado
  - type: pserv
    name: p2-database
    plan: free 

  # 2. ServiÃ§o de Backend (Docker)
  - type: web
    name: p2-backend
    dockerContext: .
    dockerfilePath: Dockerfile # ðŸš¨ Corrigido: dockerfile -> dockerfilePath
    autoDeploy: true
    plan: free
    # Removido 'env: node' e 'port'
    
    envVars:
      # ðŸš¨ CORREÃ‡ÃƒO DE SINTAXE: InterligaÃ§Ã£o do DB (Resolve cannot unmarshal)
      - key: DATABASE_URL
        value:
          fromDatabase: p2-database
          property: connectionString
      
      - key: NODE_ENV
        value: production

  # 3. ServiÃ§o de Frontend (Docker)
  - type: web
    name: p2-frontend
    dockerContext: ./frontend
    dockerfilePath: Dockerfile # ðŸš¨ Corrigido: dockerfile -> dockerfilePath
    autoDeploy: true
    plan: free
    # Removido 'port'
    
    envVars:
      # ðŸš¨ CORREÃ‡ÃƒO DE SINTAXE: Mapeia a URL pÃºblica do Backend
      - key: VITE_API_URL
        value:
          fromService: p2-backend
          property: defaultUrl